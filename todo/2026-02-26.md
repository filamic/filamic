# TODO — 2026-02-26

## Tasks

- [ ] **Pre-use Setup Page** — Create a dedicated Filament page shown when no active academic period exists. Guide the admin through: create SchoolYear → activate → create SchoolTerm → activate. Block access to all other panels until complete.

- [ ] **Student Active Status Consistency** — Wrap `syncActiveStatus()` in a database transaction. Ensure `is_active` stays in sync with `student_enrollment` as the single source of truth. Cover edge cases: concurrent updates, missing enrollment, school_id null check.

- [ ] **Scope Hardening with `qualifyColumn()`** — Audit all custom model scopes (especially `eligibleForMonthlyFee` and any scope used in joins). Replace bare column names with `$query->qualifyColumn('column')` to prevent ambiguous column errors in joined queries.

- [ ] **Implement `GenerateMonthlyFeeInvoice` Action tests** — The test file has four `.todo()` stubs. Read the Action first, then implement: cannot generate with blank required data, cannot generate for non-existent student, can generate invoice, updates all unpaid invoices on date change.

- [ ] **Academic Period Caching** — Cache the active `SchoolYear` and `SchoolTerm` records (they rarely change). Already have `getActiveCacheKey()` and cache-clear-on-activate logic in both models. Confirm caching is wired into `getActive()` methods correctly, write tests for cache hit/miss behavior.

## Notes

- All tasks here depend on today's tasks being complete and passing.
- Each task = one commit minimum. Don't batch unrelated changes.
- Run `composer analyse && composer test` before each commit.
